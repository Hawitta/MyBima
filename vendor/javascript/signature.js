// signature@0.0.2 downloaded from https://ga.jspm.io/npm:signature@0.0.2/lib/signature.js

import t from"crypto";var e="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var i={};var a=i.Token=function(t,i){(this||e).key=t;(this||e).secret=i};a.prototype={sign:function(t){return t.sign(this||e)}};var h="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var s={};var r=t;var n=s.Request=function(t,e,i){if("string"!=typeof e)throw"Expected string";if("object"!=typeof i)throw"Expected object";var a={},s={},r;for(var n in i){r=n.toLowerCase();"auth_"==r.substring(0,5)?s[r]=i[n]:a[r]=i[n]}(this||h).method=t.toUpperCase();(this||h).path=e;(this||h).query_hash=a;(this||h).auth_hash=s};n.prototype={sign:function(t){(this||h).auth_hash={auth_version:"1.0",auth_key:t.key,auth_timestamp:Math.floor((new Date).getTime()/1e3)};(this||h).auth_hash["auth_signature"]=this.signature(t);return(this||h).auth_hash},authenticate_by_token_with_exceptions:function(t,e){e=e||600;this.validate_version();this.validate_timestamp(e);this.validate_signature(t);return true},authenticate_by_token:function(t,e){e=e||600;try{this.authenticate_by_token_with_exceptions(t,e);return true}catch(t){return false}},authenticate:function(t,e){e=e||600;var i=(this||h).auth_hash["auth_key"];if(!i)throw"Authentication key required";var a=t(i);if(!a||!a.secret)throw"Invalid authentication key";this.authenticate_by_token_with_exceptions(a,e);return a},get auth_hash(){if(!(this||h)._auth_hash||!(this||h)._auth_hash["auth_signature"])throw"Request not signed";return(this||h)._auth_hash},set auth_hash(t){(this||h)._auth_hash=t},signature:function(t){return r.createHmac("sha256",t.secret).update(this.string_to_sign()).digest("hex")},string_to_sign:function(){return[(this||h).method,(this||h).path,this.parameter_string()].join("\n")},parameter_string:function(){var t={},e=[],i;for(i in(this||h).query_hash)t[i.toLowerCase()]=(this||h).query_hash[i];if((this||h).auth_hash)for(i in(this||h).auth_hash)t[i.toLowerCase()]=(this||h).auth_hash[i];delete t["auth_signature"];for(i in t)e.push(i+"="+t[i]);return e.sort().join("&")},validate_version:function(){var t=(this||h).auth_hash["auth_version"];if(!t)throw"Version required";if("1.0"!=t)throw"Version not supported";return true},validate_timestamp:function(t){if(null==t)return true;var e=(this||h).auth_hash["auth_timestamp"],i=Math.floor((new Date).getTime()/1e3),a=Math.abs(parseInt(e)-i);if(!e)throw"Timestamp required";if(a>=t)throw"Timestamp expired: Given timestamp "+"("+e+") "+"not within "+t+"s of server time "+"("+i+")";return true},validate_signature:function(t){var e=this.signature(t);if((this||h).auth_hash["auth_signature"]!=e)throw"Invalid signature: you should have "+"sent "+e+", but you sent "+(this||h).auth_hash["auth_signature"];return true}};var u={};u.Token=i.Token;u.Request=s.Request;const o=u.Token,_=u.Request;export default u;export{_ as Request,o as Token};

